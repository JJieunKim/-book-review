## 1 ARMv8 소개
ARM은 대표적인 RISC 계열 마이크로프로세서로, 구조가 단순하고 낮은 소비전력이 강점이다.
경쟁사 아키텍처에 비해 저전력 고성능을 인정받으며 자리잡았다.
스마트폰 시장의 양대 축인 애플과 안드로이드 진영 모두 ARM이 디자인한 코어를 사용하거나 인스트럭션 세트를 라이선스 받아 직접 설계한 코어를 사용.
VFP(v5~)와 SIMD(v6~) 등 퍼포먼스를 위한 기능과 코드 크기 감소, 가상화와 시큐리티(v6~, Trustzone) 지원 기능 등이 추가됨.

ARMv8은 2011년에 발표됬고, Cortex-A/R/M 시리즈에 따라 다르게 구현되는데 가장 먼저 발표된 ARMv8-A는 애플리케이션 프로세서 프로파일에 해당한다.
ARMv8의 가장 큰 특징은 64비트 아키텍처라는 것이다. 하지만 실행 상태(execution state)라는 개념을 도입하여 32비트 ARMv7용 코드도 실행 가능하다.


### 1.1 익셉션 모델
프로세서를 바라보는 관점이 익셉션 레벨을 기준으로 함.
익셉션은 시스템 흐름에서 벗어나 익셉션 핸들러의 처리를 필요로 하는 상태 또는 시스템 이벤트를 말한다.
프로세서는 4개의 익셉션 레벨(EL0~EL3) 중 하나의 레벨에서 동작하며 모든 익셉션 레벨에서 익셉션이 발생할 수 있다.
익셉션 레벨이 높을수록 자원에 접근할 수 있는 권한 레벨도 높다.
익셉션 레벨은 해당 레벨에서 동작하는 프로그램을 염두에 두고 디자인되었다.
	EL0 애플리케이션
	EL1 게스트OS(커널)
	EL2 하이퍼바이저
	EL3 보안모니터
프로세서 동작 상태는 시큐리티 상태에 따라 non-secure(normal)/secure 상태로 나뉘며 서로간의 상태전환은 EL3가 담당하는데, SMC 인스트럭션이나 하드웨어 익셉션을 통해 진입 가능.
시큐리티는 보통 별도의 펌웨어를 구동시켜 관리함.


### 1.2 익셉션 레벨 변경
익셉션 레벨이 변경되면 코드 흐름과 권한도 변경됨.
익셉션이 발생 -> 같은 익셉션 레벨 or 높은 익셉션 레벨로 이동
EL0은 익셉션 핸들링이 불가능하므로 EL0에서 발생한 익셉션은 EL1이상의 레벨에서 핸들링해야함.
익셉션이 발생하는 상황
 - IRQ와 FIQ 인터럽트 시그널
 - 메모리 시스템 abort
 - 정의되지 않은(undefined) 인스트럭션 실행
 - 시스템 콜
 - 보안 모니터나 하이퍼바이저 트랩
익셉션 핸들링이 끝나고 이전 실행 코드로 복귀할 때는 명시적으로 ERET 인스트럭션을 사용해야함. 복귀 시에는 익셉션 발생과 반대로 동일한 익셉션 레벨 또는 낮은 익셉션 레벨로 이동.


### 1.3 실행 상태
* 실행상태 : 프로세서의 실행환경을 정의하는 개념으로 지원하는 레지스터의 폭, 인스트럭션 세트, 익셉션 모델, 메모리 아키텍처 등을 정의.
 - AArch64 : 64비트 실행 환경, 산술 연산 시 64비트 정수 데이터를 1개의 인스트럭션으로 처리할 수 있다.
			 이전 아키텍처에서 여러 개의 인스트럭션이 필요했던 것에 비해 연산에 필요한 클록 사이클 수가 절약된다.
			 단점; 포인터의 크기가 64비트로 증가해 포인터 변수가 차지하는 메모리 증가.
 - AArch32 : 32비트 실행 환경, ARMv7과의 호환성을 지원하기 위해 제공됨.


### 1.4 실행 상태 변경
실행 상태 변경은 현재 익셉션 레벨보다 높은 익셉션 레벨로 진입한 상태에서 원래의 익셉션 레벨로 복귀하는 과정에서 이뤄진다.
 -> 익셉션 레벨이 동일하게 유지되면 실행 상태를 변경할 수 없다.
단, EL3는 더 높은 익셉션 레벨이 존재하지 않으므로 리셋을 통해 실행 상태가 변경됨.
	eg) 실행 상태 변경, 커널은 64비트, 애플리케이션은 32비트인 경우
	커널(AArch64) <-> 애플리케이션(AArch32) 변경이 이뤄짐
실행 상태 변경의 제약
 - AArch32로의 변경 : 높은 익셉션 레벨 -> 낮은 익셉션 레벨 인경우만 가능
 - AArch64로의 변경 : 낮은 익셉션 레벨 -> 높은 익셉션 레벨 인경우만 가능
 eg) 커널이 AArch32이면 AArch64인 애플리케이션은 실행 할 수 없음.
 
 
### MEMO
* ARM사의 'technical reference manual' 참고

* 더 찾아볼 것
 - Trustzone
 - 하이퍼바이저
 
* 용어
 - ISA(Instruction Set Architecture)